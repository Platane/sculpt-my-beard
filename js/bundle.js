!function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(r)return r(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return s(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t){function e(){x.dispatch("render")}var i=Object.create(t("./renderer/svg/face")),n=Object.create(t("./renderer/svg/pointControl")),s=Object.create(t("./renderer/svg/zoneEvent")),r=Object.create(t("./renderer/basicEvent")),o=Object.create(t("./renderer/timeLine/timeLine")),a=Object.create(t("./renderer/timeLine/map")),c=Object.create(t("./model/data/Face")),h=Object.create(t("./model/data/TimeLine")),u=Object.create(t("./model/app-state/Camera")),l=Object.create(t("./model/app-state/TimeLineState")),d=Object.create(t("./model/history")),m=Object.create(t("./controller/drawZone/dragPoint")),p=Object.create(t("./controller/drawZone/camera")),f=Object.create(t("./controller/timeLine/key")),v=Object.create(t("./controller/timeLine/cursor")),y=Object.create(t("./controller/ctrlZ")),b=Object.create(t("./staticController/applyTimeLine")),g=Object.create(t("./staticController/recompute")),x=t("./system/eventDispatcher");t("./layout"),t("./utils/doubleClick"),c.init(),u.init(),l.init(),h.init(),d.init();var k={face:c,camera:u,timeLineState:l,timeLine:h,history:d};window.modelBall=k;var L=document.querySelector(".app-draw-zone");i.init(k,L),n.init(k,L),s.init(k,L),r.init(k),o.init(k,document.querySelector(".app-timeLine")),a.init(k,document.querySelector(".app-timeLineMap")),m.init(k).enable(),p.init(k).enable(),f.init(k).enable(),y.init(k).enable(),v.init(k).enable(),b.init(k).enable(),g.init(k).enable(),c.chunk.mustach_left.line=[{x:99,y:25},{x:130,y:36.5},{x:189.75,y:36.7},{x:201.5,y:84}],c.chunk.mustach_left.width=[10,12,15,6],c.chunk.mustach_right.line=[{x:101,y:25},{x:70,y:36.5},{x:10.25,y:36.7},{x:-1.5,y:84}],c.chunk.mustach_right.width=[10,12,15,6],c.chunk.mustach_left.recompute(),c.chunk.mustach_right.recompute(),x.listen("please-render",e.bind(this),this),e();var w=function(){x.dispatch("please-render")};x.listen("change:shape",w),x.listen("change:camera",w);var _=function(t){t.wip||t.no_history||d.save(h)};d.save(h),x.listen("change:shape",_),x.listen("change:timeLine",_)},{"./controller/ctrlZ":2,"./controller/drawZone/camera":3,"./controller/drawZone/dragPoint":4,"./controller/timeLine/cursor":5,"./controller/timeLine/key":6,"./layout":7,"./model/app-state/Camera":8,"./model/app-state/TimeLineState":9,"./model/data/Face":10,"./model/data/TimeLine":13,"./model/history":14,"./renderer/basicEvent":16,"./renderer/svg/face":17,"./renderer/svg/pointControl":18,"./renderer/svg/zoneEvent":20,"./renderer/timeLine/map":21,"./renderer/timeLine/timeLine":22,"./staticController/applyTimeLine":23,"./staticController/recompute":24,"./system/eventDispatcher":25,"./utils/doubleClick":30}],2:[function(t,e){var i=t("../utils/Abstract"),n=t("../system/eventDispatcher"),s=function(t){return this.model={history:t.history},this.keyDown=r.bind(this),this},r=function(t){if(t.mouseEvent.ctrlKey)switch(t.mouseEvent.which){case 90:n.dispatch(this.model.history.undo()!==!1?"history:undo":"history:nothing-to-undo");break;case 89:n.dispatch(this.model.history.redo()!==!1?"history:redo":"history:nothing-to-redo")}},o=function(){this.disable(),n.listen("ui-keydown",this.keyDown,this)},a=function(){n.unlisten("ui-keydown",this)};e.exports=Object.create(i).extend({init:s,enable:o,disable:a})},{"../system/eventDispatcher":25,"../utils/Abstract":28}],3:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../system/eventDispatcher"),s=function(t){return this.model={camera:t.camera},this.mouseMove=h.bind(this),this.mouseUp=u.bind(this),this.mouseDown=c.bind(this),this.wheel=a.bind(this),this},r=function(){this.disable(),n.listen("ui-zone-mousedown",this.mouseDown,this),n.listen("ui-zone-wheel",this.wheel,this)},o=function(){n.unlisten("ui-tic-mousedown",this),n.unlisten("ui-zone-mousemove",this),n.unlisten("ui-mouseup",this)},a=function(t){this.model.camera.setZoom(this.model.camera.zoom+(t.mouseEvent.deltaY<0?1:-1),t.x,t.y)&&n.dispatch("change:camera",{wip:!1})},c=function(t){t.primaryTarget&&(this._origin={x:this.model.camera.origin.x,y:this.model.camera.origin.y},this._anchor={x:t.x,y:t.y},n.listen("ui-zone-mousemove",this.mouseMove,this),n.listen("ui-mouseup",this.mouseUp,this))},h=function(t){this.model.camera.origin.x=this._origin.x+(this._anchor.x-t.x)/this.model.camera._zoom,this.model.camera.origin.y=this._origin.y+(this._anchor.y-t.y)/this.model.camera._zoom,n.dispatch("change:camera",{wip:!0})},u=function(){n.dispatch("change:camera",{wip:!1}),n.unlisten("ui-zone-mousemove",this),n.unlisten("ui-mouseup",this)};e.exports=Object.create(i).extend({init:s,enable:r,disable:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28}],4:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../system/eventDispatcher"),s=function(t){return this.model={face:t.face,camera:t.camera},this.ticDown=a.bind(this),this.ticMove=c.bind(this),this.ticUp=h.bind(this),this},r=function(){this.disable(),n.listen("ui-tic-mousedown",this.ticDown,this)},o=function(){n.unlisten("ui-tic-mousedown",this),n.unlisten("ui-zone-mousemove",this),n.unlisten("ui-mouseup",this)},a=function(t){this._shape=this.model.face.chunk[t.chunk],this._point=this._shape[t.pool][t.i],this._origin={x:this._point.x,y:this._point.y},this._anchor={x:t.x,y:t.y},n.listen("ui-zone-mousemove",this.ticMove,this),n.listen("ui-mouseup",this.ticUp,this)},c=function(t){this._point.x=this._origin.x+(t.x-this._anchor.x)/this.model.camera._zoom,this._point.y=this._origin.y+(t.y-this._anchor.y)/this.model.camera._zoom,n.dispatch("change:point",{point:this._point,shape:this._shape,wip:!0})},h=function(){n.dispatch("change:point",{point:this._point,shape:this._shape,wip:!1}),n.unlisten("ui-zone-mousemove",this),n.unlisten("ui-mouseup",this)};e.exports=Object.create(i).extend({init:s,enable:r,disable:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28}],5:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../system/eventDispatcher"),s=function(t){return this.model={timeLineState:t.timeLineState},this.CurDown=a.bind(this),this.CurMove=c.bind(this),this.CurUp=h.bind(this),this},r=function(){this.disable(),n.listen("ui-tlCursor-mousedown",this.CurDown,this)},o=function(){n.unlisten("ui-tlCursor-mousedown",this),n.unlisten("ui-tl-mousemove",this),n.unlisten("ui-mouseup",this)},a=function(t){t.primaryTarget&&(n.unlisten("ui-tl-mousemove",this),n.unlisten("ui-mouseup",this),n.listen("ui-tl-mousemove",this.CurMove,this),n.listen("ui-mouseup",this.CurUp,this))},c=function(t){this.model.timeLineState.cursor=t.date,n.dispatch("change:timeLineState-cursor",{wip:!0})},h=function(){var t=this.model.timeLineState;t.cursor=t.quantify(t.cursor),n.unlisten("ui-tl-mousemove",this),n.unlisten("ui-mouseup",this),n.dispatch("change:timeLineState-cursor",{wip:!1})};e.exports=Object.create(i).extend({init:s,enable:r,disable:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28}],6:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../system/eventDispatcher"),s=function(t){return this.model={face:t.face,timeLine:t.timeLine,timeLineState:t.timeLineState},this.keyDown=a.bind(this),this.keyMove=c.bind(this),this.keyUp=h.bind(this),this},r=function(){this.disable(),n.listen("ui-tlKey-mousedown",this.keyDown,this)},o=function(){n.unlisten("ui-tlKey-mousedown",this),n.unlisten("ui-tl-mousemove",this),n.unlisten("ui-mouseup",this)},a=function(t){this._chunk=t.chunk,this.h=t.y,this._key=this.model.timeLine.keys[t.chunk][t.i],this._removed=!1,n.unlisten("ui-tl-mousemove",this),n.unlisten("ui-mouseup",this),n.listen("ui-tl-mousemove",this.keyMove,this),n.listen("ui-mouseup",this.keyUp,this)},c=function(t){this.model.timeLineState;Math.abs(this.h-t.y)>30?this._removed||(this.model.timeLine.removeKey(this._chunk,this._key),this._removed=!0,n.dispatch("change:timeLine",{wip:!0})):(this._removed?(this._key=this.model.timeLine.addOrSetKey(this._chunk,t.date,this._key.pack),this._removed=!1):this.model.timeLine.setKeyDate(this._chunk,this._key,t.date),n.dispatch("change:timeLine",{wip:!0}))},h=function(){n.unlisten("ui-tl-mousemove",this),n.unlisten("ui-mouseup",this);var t=this.model.timeLineState;this.model.timeLine.setKeyDate(this._chunk,this._key,t.quantify(this._key.date)),n.dispatch("change:timeLine",{wip:!1})};e.exports=Object.create(i).extend({init:s,enable:r,disable:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28}],7:[function(){var t=function(t,e,i){if(t.scrollTo)return void t.scrollTo(e,i);if(null!==t.scrollLeft&&null!==t.scrollTop)return t.scrollLeft=e,void(t.scrollTop=i);if(null!==t.scrollX&&null!==t.scrollY)return t.scrollX=e,void(t.scrollY=i);throw"unable to scroll"},e=function(t){if(null!==t.scrollLeft&&null!==t.scrollTop)return{x:t.scrollLeft,y:t.scrollTop};if(null!==t.scrollX&&null!==t.scrollY)return{x:t.scrollX,y:t.scrollY};if(null!==t.pageXOffset&&null!==t.pageYOffset)return{x:t.pageXOffset,y:t.pageYOffset};throw"unable to scroll"},i=document.querySelector(".app-draw-zone"),n=document.querySelector(".app-timeLine"),s=document.querySelector(".app-timeLineMap"),r=document.querySelector(".page-app"),o=document.body,a={};a[0]=function(t,e){var a=60,c=180;e=Math.max(e,550);var h=40,u=Math.max(Math.min(.3*(e-h),320),c),l=e-u-a-h;l>400&&(l*=.95),l>600&&(l=600);var d=(e-l-u-h)/6;i.style.top=d+"px",i.style.height=l+"px",s.style.top=4*d+l+"px",s.style.height=h+"px",n.style.top=5*d+l+h+"px",n.style.height=u+"px",r.style.height=e+"px";var m=.8*t;500>m&&(m=.95*t),m>1e3&&(m=1e3),i.style.left=s.style.left=n.style.left=(t-m)/2+"px",i.style.width=s.style.width=n.style.width=m+"px",o.className="js-deferred-layout"};var c=function(){a[0](document.body.offsetWidth,window.innerHeight)},h=0,u=function(){window.clearTimeout(h),h=window.setTimeout(c,200)};c(),window.addEventListener("resize",u,!1);var l=document.querySelector(".page-app"),d=!1,m=function(){var i=e(document.body).y;Math.abs(i-l.offsetTop)<180&&(d=!0,t(document.body,0,l.offsetTop))},p=!1,f=!1,v=0,y=function(){return d?void(d=!1):(window.clearTimeout(v),void(p?f=!0:(f=!1,v=window.setTimeout(m,550))))},b=function(t){"mouseup"==t.type?(f&&(f=!1,window.clearTimeout(v),v=window.setTimeout(m,550)),p=!1):"mousedown"==t.type&&1==t.which&&t.currentTarget==document&&(p=!0)};window.addEventListener("scroll",y,!1),window.addEventListener("resize",y,!1),document.addEventListener("mousedown",b,!1),document.addEventListener("mouseup",b,!1)},{}],8:[function(t,e){var i=t("../../utils/Abstract"),n=(t("../../system/eventDispatcher"),t("../../utils/point"),function(){return this.project=s.bind(this),this.unproject=r.bind(this),this.origin={x:0,y:0},this.zoom=2,this._zoom=a(this.zoom),this}),s=function(t){return{x:(t.x-this.origin.x)*this._zoom,y:(t.y-this.origin.y)*this._zoom}},r=function(t){return{x:t.x/this._zoom+this.origin.x,y:t.y/this._zoom+this.origin.y}},o=function(t,e,i){var n=5;if(t=Math.min(Math.max(0,+t),n),t==this.zoom)return!1;var s=this.unproject({x:+e,y:+i}),r=a(t);return this.origin.x=s.x-e/r,this.origin.y=s.y-i/r,this.zoom=t,this._zoom=r,!0},a=function(t){return 1<<t};e.exports=Object.create(i).extend({init:n,setZoom:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28,"../../utils/point":31}],9:[function(t,e){var i=t("../../utils/Abstract"),n=(t("../../system/eventDispatcher"),function(){return this.origin=0,this.zoom=30,this.window=30,this.cursor=0,this.project=s.bind(this),this.projectQ=r.bind(this),this.unproject=o.bind(this),this.quantify=a.bind(this),this}),s=function(t){return(t-this.origin)/this.window},r=function(t){return this.quantify(this.project(t))},o=function(t){return t*this.window+this.origin},a=function(t){return Math.round(t)};e.exports=Object.create(i).extend({init:n})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28}],10:[function(t,e){var i=t("../../utils/Abstract"),n=t("../mixin/historizable"),s=t("./Shape"),r=t("./Line"),o=function(){return this.chunk={mustach_left:Object.create(r).init(),mustach_right:Object.create(r).init(),beard_left:Object.create(s).init(),beard_right:Object.create(s).init(),beard_mid:Object.create(s).init()},this},a=function(){var t={};for(var e in this.chunk)t[e]=this.chunck[e].pack();return t},c=function(t){for(var e in this.chunk)this.chunck[e].unpack(t[e]);return this};e.exports=Object.create(i).extend(n).extend({init:o,pack:a,unpack:c})},{"../../utils/Abstract":28,"../mixin/historizable":15,"./Line":11,"./Shape":12}],11:[function(t,e){var i=t("./Shape"),n=(t("../../system/eventDispatcher"),t("../../system/pathJob")),s=t("../../utils/point"),r=function(){return i.init.call(this),this.line=[],this.width=[],this},o=function(){return this.vertex=n.expandMustach(this.line,this.width),i.recompute.call(this)},a=function(){return{line:this.line.slice().map(s.copy),width:this.width.slice(),sharpness:this.sharpness.slice()}};e.exports=Object.create(i).extend({init:r,recompute:o,pack:a})},{"../../system/eventDispatcher":25,"../../system/pathJob":27,"../../utils/point":31,"./Shape":12}],12:[function(t,e){var i=t("../../utils/Abstract"),n=t("../mixin/historizable"),s=(t("../../system/eventDispatcher"),t("../../system/pathJob")),r=t("../../utils/point"),o=function(){return this.vertex=[],this.sharpness=[],this.bezierPath=[],this},a=function(){return this.bezierPath=s.bezify(this.vertex,.15),this},c=function(){return{vertex:this.vertex.slice().map(r.copy),sharpness:this.sharpness.slice()}};e.exports=Object.create(i).extend(n).extend({init:o,recompute:a,pack:c})},{"../../system/eventDispatcher":25,"../../system/pathJob":27,"../../utils/Abstract":28,"../../utils/point":31,"../mixin/historizable":15}],13:[function(t,e){var i=t("../../utils/Abstract"),n=t("../mixin/historizable"),s=(t("../../system/eventDispatcher"),function(){return this.keys={},this}),r=function(t,e){return t.date<e.date?-1:1},o=function(t,e,i){this.keys[t]||(this.keys[t]=[]);for(var n=this.keys[t].length;n--;)if(this.keys[t][n].date==e)return void(this.keys[t][n].pack=i);var s;return this.keys[t].push(s={date:e,pack:i}),this.keys[t].sort(r),s},a=function(t,e){var i;if(this.keys[t]&&!((i=this.keys[t].indexOf(e))<=-1))return this.keys[t].splice(i,1)[0]},c=function(t,e,i){return e.date=i,this.keys[t].sort(r),e};e.exports=Object.create(i).extend(n).extend({init:s,addOrSetKey:o,setKeyDate:c,removeKey:a})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28,"../mixin/historizable":15}],14:[function(t,e){var i=t("../utils/Abstract"),n=t("./mixin/historizable"),s=t("../system/eventDispatcher"),r=function(){return this.stack=[],this.undo_stack=[],this},o=function(t){for(this.stack.push({model:t,pack:t.pack()}),this.undo_stack.length=0;this.stack.length>50;)this.stack.shift()},a=function(){s.dispatch("change:timeLine",{no_history:!0})},c=function(t){if(this.stack.length<=1)return!1;var t=this.stack.pop(),e=this.stack[this.stack.length-1];t.model.unpack(n.deepCopy(e.pack)),a(t.model),this.undo_stack.push(t)},h=function(t){if(!this.undo_stack.length)return!1;var t=this.undo_stack.pop();t.model.unpack(n.deepCopy(t.pack)),this.stack.push(t),a(t.model)};e.exports=Object.create(i).extend(n).extend({init:r,undo:c,redo:h,save:o})},{"../system/eventDispatcher":25,"../utils/Abstract":28,"./mixin/historizable":15}],15:[function(t,e){var i=function(t){if("object"!=typeof t)return t;if(Array.isArray(t))return t.map(i);var e={};for(var n in t)"function"!=typeof t[n]&&(e[n]=i(t[n]));return e},n=function(t){for(var e in t)this[e]=i(t[e]);return this};e.exports={pack:function(){return i(this)},unpack:n,deepCopy:i}},{}],16:[function(t,e){var i=t("../utils/Abstract"),n=t("../system/eventDispatcher"),s=function(t){n.dispatch("ui-"+t.type,{mouseEvent:t})},r=function(){return document.addEventListener("mousedown",s,!1),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",s,!1),document.addEventListener("keydown",s,!1),this};e.exports=Object.create(i).extend({init:r})},{"../system/eventDispatcher":25,"../utils/Abstract":28}],17:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../system/eventDispatcher"),s=t("../../utils/domHelper"),r=t("./svg-util"),o=function(){var t=this.model.face,e=this.model.camera,i=function(t){var i=e.project(t);return i.type=t.type,i};for(var n in t.chunk)t.chunk[n].recompute(),this.dom[n].setAttribute("d",r.renderBezier(t.chunk[n].bezierPath.map(i)))},a=function(t){var e=this.model.face;this.dom={};var i=1;for(var n in e.chunk)this.dom[n]=r.create("path"),this.dom[n].setAttribute("class","hair-chunk "+n+" hair-chunk-"+i++),t.appendChild(this.dom[n]),s.addClass(this.dom[n],"color-filled")},c=function(t,e){return this.model={face:t.face,camera:t.camera},a.call(this,e),n.listen("render",o.bind(this),this),this};e.exports=Object.create(i).extend({init:c,render:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28,"../../utils/domHelper":29,"./svg-util":19}],18:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../system/eventDispatcher"),s=t("./svg-util"),r=function(t,e){var i=s.create("circle");return i.setAttribute("cx",t),i.setAttribute("cy",e),i.setAttribute("r",5),i.setAttribute("class","control-tic"),i},o=function(){var t=this.model.face,e=this.model.camera.project;for(var i in t.chunk){var n=this.dom[i],s=t.chunk[i];n.innerHTML="";var o,a,c;s.line?(o=s.line,a="control-line",c="line"):(o=s.vertex,a="control-path",c="vertex"),o.map(e).forEach(function(t,e){var s=r(t.x,t.y);s.setAttribute("class","control-tic "+a),s.setAttribute("data-i",e),s.setAttribute("data-chunk",i),s.setAttribute("data-pool",c),n.appendChild(s)})}},a=function(t){var e=this.model.face;this.dom={};for(var i in e.chunk)this.dom[i]=s.create("g"),this.dom[i].className="control control-"+i,this.dom[i].setAttribute("data-chunk",i),t.appendChild(this.dom[i])},c=function(t,e){return this.model={face:t.face,camera:t.camera},a.call(this,e),n.listen("render",o.bind(this),this),this};e.exports=Object.create(i).extend({init:c,render:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28,"./svg-util":19}],19:[function(t,e){var i=function(t){return(0|100*t)/100},n=function(t){return i(t.x)+" "+i(t.y)},s=function(t){if(!t.length)return"";for(var e="M"+n(t[0]),i=1;i<t.length;i++)switch(t[i].type){case"F":e+="L"+n(t[i]);break;case"C":e+="Q"+n(t[i++])+" "+n(t[i])}return e+"z"},r=function(t,e){return"M"+t.reduce(function(t,e){return t+"L"+n(e)},"").slice(1)+(e?"z":"")},o="http://www.w3.org/2000/svg",a=function(t){return document.createElementNS(o,t)};e.exports={renderBezier:s,renderLine:r,create:a,svgNS:o}},{}],20:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../system/eventDispatcher"),s=t("../../utils/domHelper"),r=function(t){if(1===t.which){var e=t.target.getAttribute("class").split(" "),i=s.offset(t.target),r=t.pageX-i.left,o=t.pageY-i.top,a=!0;e.indexOf("control-tic")>=0&&"wheel"!=t.type&&(n.dispatch("ui-tic-"+t.type,{mouseEvent:t,pool:t.target.getAttribute("data-pool"),chunk:t.target.getAttribute("data-chunk"),i:t.target.getAttribute("data-i"),x:r,y:o,primaryTarget:!0}),a=!1),n.dispatch("ui-zone-"+t.type,{mouseEvent:t,x:r,y:o,primaryTarget:a}),"wheel"==t.type&&(t.stopPropagation(),t.preventDefault())}},o=function(t,e){return e.addEventListener("mousedown",r,!1),e.addEventListener("mousemove",r,!1),e.addEventListener("mouseup",r,!1),e.addEventListener("wheel",r,!1),this.domSvg=e,this};e.exports=Object.create(i).extend({init:o})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28,"../../utils/domHelper":29}],21:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../utils/domHelper"),s=t("../../system/eventDispatcher"),r=function(){var t=this.model.timeLine,e=this.model.timeLineState,i=e.cursor,n=e.cursor;for(var s in t.keys)t.keys[s].length&&(i=Math.max(i,t.keys[s][t.keys[s].length-1].date),n=Math.min(n,t.keys[s][0].date));n=Math.min(n,e.origin),i=Math.max(i,e.origin+e.window),i+=5,n-=5;var r=this.end!==i||this.start!==n;return this.end=i,this.start=n,r},o=function(){this.domFrame.style.width=this.model.timeLineState.window/(this.end-this.start)*100+"%",this.domFrame.style.left=(this.model.timeLineState.origin-this.start)/(this.end-this.start)*100+"%"},a=function(){this.domCursor.style.left=(this.model.timeLineState.cursor-this.start)/(this.end-this.start)*100+"%"},c=function(){r.call(this),o.call(this),a.call(this)},h=['<div class="tlm-frame">',"</div>"].join(""),u=['<div class="tlm-cursor">',"</div>"].join(""),l=function(t){n.addClass(t,"tlm"),this.domFrame=n.domify(h),this.domCursor=n.domify(u),t.appendChild(this.domFrame),t.appendChild(this.domCursor)},d=function(t,e){return this.model={timeLineState:t.timeLineState,timeLine:t.timeLine},l.call(this,e),s.listen("change:timeLineState-cursor",c.bind(this),this),s.listen("change:timeLineState-viewport",c.bind(this),this),this};e.exports=Object.create(i).extend({init:d})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28,"../../utils/domHelper":29}],22:[function(t,e){var i=t("../../utils/Abstract"),n=t("../../utils/domHelper"),s=t("../../system/eventDispatcher"),r=([].join(""),['<div class="tl-key">',"</div>"].join("")),o=['<div class="tl-row">','<svg class="tl-icon" viewBox="0 0 100 100"><path d="M50 0L93.3 25L93.3 75L50 100L6.7 75L6.7 25z"></path></svg>','<span class="tl-label"></span>','<div class="tl-toolBar"></div>',"</div>"].join(""),a=['<div class="tl-row">',"</div>"].join(""),c=['<div class="tl">','<div class="tl-left">','<div class="tl-global-label"></div>','<div class="tl-block-label"></div>',"</div>",'<div class="tl-right">','<div class="tl-right-push"></div>','<div class="tl-block-lines"></div>','<div class="tl-cursor"></div>',"</div>","</div>"].join(""),h=function(t){if(1===t.which){var e,i,r=n.offset(this.domBlockLines),o=t.pageX-r.left,a=t.pageY-r.top,c=this.model.timeLineState.unproject(o/this.domBlockLines.offsetWidth),h=!0;n.getParent(t.target,"tl-cursor")&&(s.dispatch("ui-tlCursor-"+t.type,{date:c,y:a,x:o,mouseEvent:t,primaryTarget:h}),h=!1),(e=n.getParent(t.target,"tl-key"))&&(s.dispatch("ui-tlKey-"+t.type,{mouseEvent:t,chunk:n.getParent(e,"tl-row").getAttribute("data-chunk"),i:e.getAttribute("data-i"),date:c,y:a,x:o,primaryTarget:h}),h=!1),(i=n.getParent(t.target,"tl-row"))&&(s.dispatch("ui-tlLine-"+t.type,{mouseEvent:t,chunk:i.getAttribute("data-chunk"),date:c,y:a,x:o,primaryTarget:h}),h=!1),s.dispatch("ui-tl-"+t.type,{mouseEvent:t,date:c,y:a,x:o,primaryTarget:h}),t.preventDefault()}},u=function(){var t=this.model.timeLine,e=this.model.timeLineState.project;for(var i in this.domLines){for(var s=this.domLines[i].children,o=s.length;o--;)s[o].remove();for(var o=(t.keys[i]||[]).length;o--;){var a=e(t.keys[i][o].date);if(!(-.01>a||a>1.01)){var c=n.domify(r);c.setAttribute("data-i",o),c.style.left="calc( "+100*a+"% - 5px )",this.domLines[i].appendChild(c)}}}},l=function(){var t=this.model.timeLineState.project;this.domCursor.style.left="calc( "+100*t(this.model.timeLineState.cursor)+"% - 0.5px )"},d=function(){var t=this.model.face;this.domEl=n.domify(c);var e=this.domEl.querySelector(".tl-block-label"),i=this.domEl.querySelector(".tl-block-lines");this.domCursor=this.domEl.querySelector(".tl-cursor"),this.domLines={};for(var s in t.chunk){var r=n.domify(o),h=n.domify(a);r.querySelector(".tl-label").innerHTML=s.replace("_"," "),h.setAttribute("data-chunk",s),e.appendChild(r),i.appendChild(h),this.domLines[s]=h}this.domBlockLines=i},m=function(t,e){this.model={face:t.face,timeLineState:t.timeLineState,timeLine:t.timeLine},d.call(this),e.className+=" tl";for(var i=this.domEl.children.length;i--;)e.appendChild(this.domEl.children[i]);return this.domEl=e,s.listen("change:timeLine",u.bind(this),this),s.listen("change:timeLineState-cursor",l.bind(this),this),s.listen("change:timeLineState-viewport",l.bind(this),this),s.listen("change:timeLineState-viewport",u.bind(this),this),this.domEl.querySelector(".tl-right").addEventListener("mousedown",h.bind(this),!1),this.domEl.querySelector(".tl-right").addEventListener("mouseup",h.bind(this),!1),this.domEl.querySelector(".tl-right").addEventListener("mousemove",h.bind(this),!1),this.domEl.querySelector(".tl-right").addEventListener("wheel",h.bind(this),!1),this};e.exports=Object.create(i).extend({init:m})},{"../../system/eventDispatcher":25,"../../utils/Abstract":28,"../../utils/domHelper":29}],23:[function(t,e){var i=t("../utils/Abstract"),n=t("../system/eventDispatcher"),s=t("../system/interpolate"),r=function(t){return this.model={face:t.face,timeLine:t.timeLine,timeLineState:t.timeLineState},this.changeShape=c.bind(this),this.changeCursor=h.bind(this),this},o=function(){this.disable(),n.listen("change:shape",this.changeShape,this),n.listen("change:timeLineState-cursor",this.changeCursor,this)},a=function(){n.unlisten("change:shape",this),n.unlisten("change:timeLineState-cursor",this)},c=function(t){if(!t.wip&&!t.is_interpolation){for(var e in this.model.face.chunk)if(this.model.face.chunk[e]==t.shape)break;this.model.timeLine.addOrSetKey(e,this.model.timeLineState.cursor,t.shape.pack()),n.dispatch("change:timeLine",{wip:!1})}},h=function(t){var e=this.model.face.chunk,i=this.model.timeLineState.cursor,r=this.model.timeLine.keys;if(this._cursor!=i)for(var o in r){var a=r[o];if(i<=a[0].date)e[o].unpack(a[0].pack);else if(i>=a[a.length-1].date)e[o].unpack(a[a.length-1].pack);else{for(var c=1;c<a.length&&a[c].date<i;c++);var h=a[c-1],u=a[c],l=(i-h.date)/(u.date-h.date);e[o].unpack(s.lerpPack(h.pack,u.pack,l))}n.dispatch("change:point",{wip:t.wip,shape:e[o],is_interpolation:!0})}};e.exports=Object.create(i).extend({init:r,enable:o,disable:a})},{"../system/eventDispatcher":25,"../system/interpolate":26,"../utils/Abstract":28}],24:[function(t,e){var i=t("../utils/Abstract"),n=t("../system/eventDispatcher"),s=function(){return this.changePoint=a.bind(this),this},r=function(){this.disable(),n.listen("change:point",this.changePoint,this)},o=function(){n.unlisten("change:point",this)},a=function(t){t.shape.recompute(),n.dispatch("change:shape",{wip:t.wip,is_interpolation:t.is_interpolation,shape:t.shape})};e.exports=Object.create(i).extend({init:s,enable:r,disable:o})},{"../system/eventDispatcher":25,"../utils/Abstract":28}],25:[function(t,e){var i=t("../utils/Abstract"),n={},s=function(t,e){switch(t){case"ui-mousemove":}this._lock=!0;for(var i=n[t]||[],s=0;s<i.length;s++)i[s].fn(e,t);for(this._lock=!1;(this._stack||[]).length;){var r=this._stack.shift();this[r.fn].apply(this,r.args)}return this},r=function(t,e,i){return this._lock?void(this._stack=this._stack||[]).push({fn:"listen",args:arguments}):((n[t]=n[t]||[]).push({fn:e,key:i}),this)},o=function(t,e){if(this._lock)return void(this._stack=this._stack||[]).push({fn:"unlisten",args:arguments});for(var i=n[t]=n[t]||[],s=i.length;s--;)i[s].key==e&&i.splice(s,1);return this},a=function(t){return!!(n[t]||[]).length},c=function(){n={}};e.exports=Object.create(i).extend({dispatch:s,listen:r,unlisten:o,hasListener:a,reset:c})},{"../utils/Abstract":28}],26:[function(t,e){var i=t("../utils/point"),n=function(t,e,n){for(;t.length<e.length;)t.push(i.copy(e[e.length-1]));for(;e.length<t.length;)e.push(i.copy(t[t.length-1]));for(var s=[],r=0;r<t.length;r++)s.push(i.lerp(t[r],e[r],n));return s},s=function(t,e,n){for(;t.length<e.length;)t.push(i.copy(e[e.length-1]));for(;e.length<t.length;)e.push(i.copy(t[t.length-1]));for(var s=[],r=1-n,o=0;o<t.length;o++)s.push(r*t[o]+n*e[o]);return s},r=function(t,e,i){var r={};for(var o in t)switch(o){case"line":case"vertex":r[o]=n(t[o],e[o],i);break;case"width":r[o]=s(t[o],e[o],i)}return r};e.exports={lerpPack:r}},{"../utils/point":31}],27:[function(t,e){var i=t("../utils/point"),n=function(t){for(var e,i,n=t[0],s=t.length;s--;)e=n,n=t[s],(i=n.next+e.before>1)&&(n.next/=i,e.before/=i);return t},s=function(t,e){var s;if(t.length<2)return[];e&&"number"!=typeof e?n(e):s=e||.25;for(var r,o,a,c,h,u=t[0],l=t[1],d=[],m=t.length;m--;)r=l,l=u,u=t[m],h=s||e[m].before,c=s||e[m].after,o=i.lerp(l,u,h),a=i.lerp(l,r,c),o.type="F",a.type="F",l.type="C",d.push(a,l,o);return d},r=function(t,e){return t.reduce(function(n,s,r){if(0==r||r==t.length-1)return n.push(s),n;var o=i.normalize(i.diff(t[r-1],s)),a=i.normalize(i.diff(s,t[r+1])),c=o;c.x=a.x+o.x,c.y=a.y+o.y,i.normalize(c);var h=c.x;return c.x=c.y,c.y=-h,n.unshift({x:s.x+c.x*e[r],y:s.y+c.y*e[r]}),n.push({x:s.x-c.x*e[r],y:s.y-c.y*e[r]}),n},[])};e.exports={expandMustach:r,bezify:s}},{"../utils/point":31}],28:[function(t,e){e.exports={init:function(){return this},extend:function(t){for(var e in t)this[e]=t[e];return this}}},{}],29:[function(t,e){e.exports={hasClass:function(t,e){return t.classList.contains(e)},addClass:function(t,e){t.setAttribute("class",t.getAttribute("class")+" "+e)},removeClass:function(t,e){for(var i="",n=t.classList.length;n--;)e!=t.classList[n]&&(i+=" "+t.classList[n]);t.className=i},getParent:function(t,e){for(;;){if(!t||this.hasClass(t,e))break;t=t.parentElement}return t},offset:function(t){for(var e={left:0,top:0};t&&null!==t.offsetLeft;)e.left+=t.offsetLeft,e.top+=t.offsetTop,t=t.parentElement;return e},bind:function(t,e,i){var n=e.split(" ");if(n.length>1)for(var s=n.length;s--;)this.bind(t,n[s],i);else t._bindHandlers=t._bindHandlers||{},this.unbind(t,e),t.addEventListener(e.split(".")[0],i,!1),t._bindHandlers[e]=i},unbind:function(t,e){var i=e.split(" ");if(i.length>1)for(var n=i.length;n--;)this.unbind(t,i[n]);else t._bindHandlers&&t._bindHandlers[e]&&(t.removeEventListener(e.split(".")[0],t._bindHandlers[e],!1),t._bindHandlers[e]=null)},domify:function(){if("object"!=typeof document)return function(){};var t=document.createElement("div");return function(e){t.innerHTML=e;var i=t.children[0];return t.innerHTML="",i}}()}},{}],30:[function(){!function(){var t,e,i={},n=0;document.addEventListener("mousedown",function(s){0==n||s.timeStamp-t>400?(t=s.timeStamp,e=s.target,i.x=s.pageX,i.y=s.pageY,n=1):n++}),document.addEventListener("mouseup",function(s){if(e!=s.target||s.timeStamp-t>400||Math.abs(i.x-s.pageX)>25||Math.abs(i.y-s.pageY)>25)return void(n=0);if(n>=2){var r=new MouseEvent("doubleclick",s);s.target.dispatchEvent(r),n=0}})}()},{}],31:[function(t,e){var i={};i.scalaire=function(t,e){return t.x*e.x+t.y*e.y},i.norme=function(t){return Math.sqrt(i.scalaire(t,t))},i.normalize=function(t){var e=i.norme(t);return t.x/=e,t.y/=e,t},i.diff=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},i.lerp=function(t,e,i){var n=1-i;return{x:t.x*n+e.x*i,y:t.y*n+e.y*i}},i.copy=function(t){return{x:t.x,y:t.y}},e.exports=i},{}]},{},[1]);