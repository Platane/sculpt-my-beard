!function t(e,i,s){function n(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return n(i?i:t)},l,l.exports,t,e,i,s)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t){function e(){i.dispatch("render")}var i=t("./system/eventDispatcher");t("./layout"),t("./utils/doubleClick"),t("./utils/shortClick");var s={face:t("./model/data/face"),camera:t("./model/app-state/camera"),timeLineState:t("./model/app-state/timeLineState"),timeLine:t("./model/data/timeLine"),toolkit:t("./model/app-state/toolkit"),history:t("./model/history")};for(var n in s)s[n]=Object.create(s[n]).init();var r=document.querySelector(".app-draw-zone"),o=document.querySelector(".app-timeLine"),a=document.querySelector(".app-timeLineMap"),h=document.querySelector(".app-vertical-toolbar"),c={face:t("./renderer/svg/face"),pointControl:t("./renderer/svg/pointControl"),widthControl:t("./renderer/svg/widthControl"),sharpnessControl:t("./renderer/svg/sharpnessControl"),zoneEvent:t("./renderer/svg/zoneEvent"),basicEvent:t("./renderer/basicEvent"),timeLine:t("./renderer/timeLine/timeLine"),timeLineMap:t("./renderer/timeLine/map"),toolkit:t("./renderer/toolbar/toolkit")};c.face.init(s,i,r),c.sharpnessControl.init(s,i,r),c.widthControl.init(s,i,r),c.pointControl.init(s,i,r),c.zoneEvent.init(s,i,r),c.basicEvent.init(s,i),c.timeLine.init(s,i,o),c.timeLineMap.init(s,i,a),c.toolkit.init(s,i,h);var l={dragPoint:t("./controller/drawZone/dragPoint"),dragWidth:t("./controller/drawZone/dragWidth"),dragSharpness:t("./controller/drawZone/dragSharpness"),drawZoneTranslate:t("./controller/drawZone/translate"),drawZoneZoom:t("./controller/drawZone/zoom"),timeLineMoveKey:t("./controller/timeLine/key"),timeLineCursorDrag:t("./controller/timeLine/cursor-drag"),timeLineCursorClick:t("./controller/timeLine/cursor-click"),timeLineTranslate:t("./controller/timeLine/viewport-translate"),toolbar:t("./controller/toolbar/toolkit"),ctrlZ:t("./controller/ctrlZ"),applyTimeLine:t("./staticController/applyTimeLine"),recompute:t("./staticController/recompute"),optionnalCtrl:t("./staticController/optionnalCtrl")};for(var n in l)l[n]=Object.create(l[n]).init(s,i,l),l[n].enable();var u=s.face;u.chunk.mustach_left.line=[{x:99,y:25},{x:130,y:36.5},{x:189.75,y:36.7},{x:201.5,y:84}],u.chunk.mustach_left.width=[10,12,15,6],u.chunk.mustach_left.sharpness=[{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15}],u.chunk.mustach_right.line=[{x:101,y:25},{x:70,y:36.5},{x:10.25,y:36.7},{x:-1.5,y:84}],u.chunk.mustach_right.width=[10,12,15,6],u.chunk.mustach_right.sharpness=[{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15}],u.chunk.beard_mid.vertex=[{x:50,y:100},{x:80,y:110},{x:120,y:110},{x:150,y:100},{x:110,y:160},{x:90,y:160}],u.chunk.beard_mid.sharpness=[{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15},{before:.15,after:.15}],u.chunk.mustach_left.recompute(),u.chunk.mustach_right.recompute(),u.chunk.beard_mid.recompute(),i.listen("please-render",e.bind(this),this),e();var d=function(){i.dispatch("please-render")};i.listen("change:shape",d),i.listen("change:camera",d),i.listen("change:toolkit",d),i.dispatch("change:shape",{shape:u.chunk.mustach_right}),i.dispatch("change:shape",{shape:u.chunk.mustach_left}),i.dispatch("change:shape",{shape:u.chunk.beard_mid}),i.dispatch("change:toolkit")},{"./controller/ctrlZ":2,"./controller/drawZone/dragPoint":3,"./controller/drawZone/dragSharpness":4,"./controller/drawZone/dragWidth":5,"./controller/drawZone/translate":6,"./controller/drawZone/zoom":7,"./controller/timeLine/cursor-click":8,"./controller/timeLine/cursor-drag":9,"./controller/timeLine/key":10,"./controller/timeLine/viewport-translate":11,"./controller/toolbar/toolkit":12,"./layout":13,"./model/app-state/camera":14,"./model/app-state/timeLineState":15,"./model/app-state/toolkit":16,"./model/data/face":17,"./model/data/timeLine":20,"./model/history":21,"./renderer/basicEvent":23,"./renderer/svg/face":24,"./renderer/svg/pointControl":25,"./renderer/svg/sharpnessControl":26,"./renderer/svg/widthControl":28,"./renderer/svg/zoneEvent":29,"./renderer/timeLine/map":30,"./renderer/timeLine/timeLine":31,"./renderer/toolbar/toolkit":32,"./staticController/applyTimeLine":33,"./staticController/optionnalCtrl":34,"./staticController/recompute":35,"./system/eventDispatcher":36,"./utils/doubleClick":42,"./utils/shortClick":44}],2:[function(t,e){var i=t("../utils/Abstract"),s=t("../system/eventDispatcher"),n=function(t){return this.model={history:t.history},this.keyDown=r.bind(this),this},r=function(t){if(t.mouseEvent.ctrlKey)switch(t.mouseEvent.which){case 90:s.dispatch(this.model.history.undo()!==!1?"history:undo":"history:nothing-to-undo");break;case 89:s.dispatch(this.model.history.redo()!==!1?"history:redo":"history:nothing-to-redo")}},o=function(){this.disable(),s.listen("ui-keydown",this.keyDown,this)},a=function(){s.unlisten("ui-keydown",this)};e.exports=Object.create(i).extend({init:n,enable:o,disable:a})},{"../system/eventDispatcher":36,"../utils/Abstract":40}],3:[function(t,e){var i=t("../../utils/Abstract"),s=function(t,e){return this.model={face:t.face},this.ed=e,this.ticDown=o.bind(this),this.ticMove=a.bind(this),this.ticUp=h.bind(this),this},n=function(){this.disable(),this.ed.listen("ui-tic-mousedown",this.ticDown,this)},r=function(){this.ed.unlisten("ui-tic-mousedown",this),this.ed.unlisten("ui-zone-mousemove",this),this.ed.unlisten("ui-mouseup",this)},o=function(t){this._shape=this.model.face.chunk[t.chunk],this._point=this._shape[t.pool][t.i],this.ed.listen("ui-zone-mousemove",this.ticMove,this),this.ed.listen("ui-mouseup",this.ticUp,this)},a=function(t){this._point.x=t.x,this._point.y=t.y,this.ed.dispatch("change:point",{point:this._point,shape:this._shape,wip:!0})},h=function(){this.ed.dispatch("change:point",{point:this._point,shape:this._shape,wip:!1}),this.ed.unlisten("ui-zone-mousemove",this),this.ed.unlisten("ui-mouseup",this)};e.exports=Object.create(i).extend({init:s,enable:n,disable:r})},{"../../utils/Abstract":40}],4:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/point"),n=function(t,e){return this.model={face:t.face,camera:t.camera},this.ed=e,this.ticDown=a.bind(this),this.ticMove=h.bind(this),this.ticUp=c.bind(this),this},r=function(){this.disable(),this.ed.listen("ui-sharpness-tic-mousedown",this.ticDown,this)},o=function(){this.ed.unlisten("ui-sharpness-tic-mousedown",this),this.ed.unlisten("ui-zone-mousemove",this),this.ed.unlisten("ui-mouseup",this)},a=function(t){this._shape=this.model.face.chunk[t.chunk],this._i=+t.i,this._sens=t.sens,this._sens2="after"==this._sens?"before":"after",this._i2=("after"==this._sens?this._i+1:this._i+this._shape.vertex.length-1)%this._shape.vertex.length,this._val2=this._shape.sharpness[this._i2][this._sens2],this.ed.listen("ui-zone-mousemove",this.ticMove,this),this.ed.listen("ui-mouseup",this.ticUp,this)},h=function(t){var e,i=this.model.camera.project(this._shape.vertex[this._i]),n=this.model.camera.project(this._shape.vertex[this._i2]),r=s.normalize(s.diff(n,i)),o={x:t.screenX,y:t.screenY},a=s.scalaire(r,s.diff(o,i));if(0>a)e=0;else{var h=s.distance(o,i);e=.5>a/h?2*a:h}e=Math.max(Math.min((e-15)/60,1),0),e!=this._shape.sharpness[this._i][this._sens]&&(this._shape.sharpness[this._i][this._sens]=e,this._shape.sharpness[this._i2][this._sens2]=e+this._val2>1?1-e:this._val2,this.ed.dispatch("change:point",{shape:this._shape,wip:!0}))},c=function(){this.ed.dispatch("change:point",{shape:this._shape,wip:!1}),this.ed.unlisten("ui-zone-mousemove",this),this.ed.unlisten("ui-mouseup",this)};e.exports=Object.create(i).extend({init:n,enable:r,disable:o})},{"../../utils/Abstract":40,"../../utils/point":43}],5:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/point"),n=function(t,e){return this.model={face:t.face},this.ed=e,this.ticDown=a.bind(this),this.ticMove=h.bind(this),this.ticUp=c.bind(this),this},r=function(){this.disable(),this.ed.listen("ui-width-tic-mousedown",this.ticDown,this)},o=function(){this.ed.unlisten("ui-width-tic-mousedown",this),this.ed.unlisten("ui-zone-mousemove",this),this.ed.unlisten("ui-mouseup",this)},a=function(t){this._shape=this.model.face.chunk[t.chunk],this._i=t.i,this.ed.listen("ui-zone-mousemove",this.ticMove,this),this.ed.listen("ui-mouseup",this.ticUp,this)},h=function(t){this._shape.width[this._i]=s.distance(this._shape.line[this._i],t),this.ed.dispatch("change:point",{shape:this._shape,wip:!0})},c=function(){this.ed.dispatch("change:point",{shape:this._shape,wip:!1}),this.ed.unlisten("ui-zone-mousemove",this),this.ed.unlisten("ui-mouseup",this)};e.exports=Object.create(i).extend({init:n,enable:r,disable:o})},{"../../utils/Abstract":40,"../../utils/point":43}],6:[function(t,e){var i=t("../../utils/Abstract"),s=function(t,e){return this.model={camera:t.camera},this.ed=e,this.mouseMove=a.bind(this),this.mouseUp=h.bind(this),this.mouseDown=o.bind(this),this},n=function(){this.disable(),this.ed.listen("ui-zone-mousedown",this.mouseDown)},r=function(){this.ed.unlisten("ui-zone-mousedown",this.mouseDown),this.ed.unlisten("ui-zone-mousemove",this.mouseMove),this.ed.unlisten("ui-mouseup",this.mouseUp)},o=function(t){t.primaryTarget&&(this._origin={x:this.model.camera.origin.x,y:this.model.camera.origin.y},this._anchor={x:t.screenX,y:t.screenY},this.ed.listen("ui-zone-mousemove",this.mouseMove),this.ed.listen("ui-mouseup",this.mouseUp))},a=function(t){this.model.camera.origin.x=this._origin.x+(this._anchor.x-t.screenX)/this.model.camera._zoom,this.model.camera.origin.y=this._origin.y+(this._anchor.y-t.screenY)/this.model.camera._zoom,this.ed.dispatch("change:camera",{wip:!0})},h=function(){this.ed.dispatch("change:camera",{wip:!1}),this.ed.unlisten("ui-zone-mousemove",this.mouseMove),this.ed.unlisten("ui-mouseup",this.mouseUp)};e.exports=Object.create(i).extend({init:s,enable:n,disable:r})},{"../../utils/Abstract":40}],7:[function(t,e){var i=t("../../utils/Abstract"),s=function(t,e){return this.model={camera:t.camera},this.ed=e,this.wheel=o.bind(this),this},n=function(){this.disable(),this.ed.listen("ui-zone-wheel",this.wheel)},r=function(){this.ed.unlisten("ui-zone-wheel",this.wheel)},o=function(t){this.model.camera.setZoom(this.model.camera.zoom+(t.mouseEvent.deltaY<0?1:-1),t.screenX,t.screenY)&&this.ed.dispatch("change:camera",{wip:!1})};e.exports=Object.create(i).extend({init:s,enable:n,disable:r})},{"../../utils/Abstract":40}],8:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../system/eventDispatcher"),n=function(t){return this.model={timeLineState:t.timeLineState},this.click=a.bind(this),this},r=function(){this.disable(),s.listen("ui-tl-shortclick",this.click,this)},o=function(){s.unlisten("ui-tl-shortclick",this)},a=function(t){if(t.primaryTarget){var e=this.model.timeLineState;e.cursor=e.quantify(t.date),s.dispatch("change:timeLineState-cursor",{wip:!1})}};e.exports=Object.create(i).extend({init:n,enable:r,disable:o})},{"../../system/eventDispatcher":36,"../../utils/Abstract":40}],9:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../system/eventDispatcher"),n=function(t){return this.model={timeLineState:t.timeLineState},this.CurDown=a.bind(this),this.CurMove=h.bind(this),this.CurUp=c.bind(this),this},r=function(){this.disable(),s.listen("ui-tlCursor-mousedown",this.CurDown,this)},o=function(){s.unlisten("ui-tlCursor-mousedown",this),s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this)},a=function(t){t.primaryTarget&&(s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this),s.listen("ui-tl-mousemove",this.CurMove,this),s.listen("ui-mouseup",this.CurUp,this))},h=function(t){this.model.timeLineState.cursor=t.date,s.dispatch("change:timeLineState-cursor",{wip:!0})},c=function(){var t=this.model.timeLineState;t.cursor=t.quantify(t.cursor),s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this),s.dispatch("change:timeLineState-cursor",{wip:!1})};e.exports=Object.create(i).extend({init:n,enable:r,disable:o})},{"../../system/eventDispatcher":36,"../../utils/Abstract":40}],10:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../system/eventDispatcher"),n=function(t){return this.model={face:t.face,timeLine:t.timeLine,timeLineState:t.timeLineState},this.keyDown=a.bind(this),this.keyMove=h.bind(this),this.keyUp=c.bind(this),this},r=function(){this.disable(),s.listen("ui-tlKey-mousedown",this.keyDown,this)},o=function(){s.unlisten("ui-tlKey-mousedown",this),s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this)},a=function(t){this._chunk=t.chunk,this.h=t.y,this._key=this.model.timeLine.keys[t.chunk][t.i],this._removed=!1,s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this),s.listen("ui-tl-mousemove",this.keyMove,this),s.listen("ui-mouseup",this.keyUp,this)},h=function(t){this.model.timeLineState;Math.abs(this.h-t.y)>30?this._removed||(this.model.timeLine.removeKey(this._chunk,this._key),this._removed=!0,s.dispatch("change:timeLine",{wip:!0})):(this._removed?(this._key=this.model.timeLine.addOrSetKey(this._chunk,t.date,this._key.pack),this._removed=!1):this.model.timeLine.setKeyDate(this._chunk,this._key,t.date),s.dispatch("change:timeLine",{wip:!0}))},c=function(){s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this);var t=this.model.timeLineState;this.model.timeLine.setKeyDate(this._chunk,this._key,t.quantify(this._key.date)),s.dispatch("change:timeLine",{wip:!1})};e.exports=Object.create(i).extend({init:n,enable:r,disable:o})},{"../../system/eventDispatcher":36,"../../utils/Abstract":40}],11:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../system/eventDispatcher"),n=function(t){return this.model={timeLineState:t.timeLineState},this.mouseDown=a.bind(this),this.mouseMove=h.bind(this),this.mouseUp=c.bind(this),this},r=function(){this.disable(),s.listen("ui-tl-mousedown",this.mouseDown,this)},o=function(){s.unlisten("ui-tl-mousedown",this),s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this)},a=function(t){t.primaryTarget&&(this._anchor=t.xPer,this._origin=this.model.timeLineState.origin,s.listen("ui-tl-mousemove",this.mouseMove,this),s.listen("ui-mouseup",this.mouseUp,this))},h=function(t){var e=this.model.timeLineState;e.origin=this._origin-(t.xPer-this._anchor)*e.window,s.dispatch("change:timeLineState-viewport",{wip:!0})},c=function(){s.unlisten("ui-tl-mousemove",this),s.unlisten("ui-mouseup",this),s.dispatch("change:timeLineState-cursor",{wip:!1})};e.exports=Object.create(i).extend({init:n,enable:r,disable:o})},{"../../system/eventDispatcher":36,"../../utils/Abstract":40}],12:[function(t,e){var i=t("../../utils/Abstract"),s=function(t,e){return this.model={toolkit:t.toolkit},this.ed=e,this.click=o.bind(this),this},n=function(){this.disable(),this.ed.listen("ui-toolbar-click",this.click,this)},r=function(){this.ed.unlisten("ui-toolbar-click",this)},o=function(t){this.model.toolkit.options[t.category][t.option]=!this.model.toolkit.options[t.category][t.option],this.ed.dispatch("change:toolkit",{wip:!1,category:t.category,option:t.option})};e.exports=Object.create(i).extend({init:s,enable:n,disable:r})},{"../../utils/Abstract":40}],13:[function(){var t=function(t,e,i){if(t.scrollTo)return void t.scrollTo(e,i);if(null!==t.scrollLeft&&null!==t.scrollTop)return t.scrollLeft=e,void(t.scrollTop=i);if(null!==t.scrollX&&null!==t.scrollY)return t.scrollX=e,void(t.scrollY=i);throw"unable to scroll"},e=function(t){if(null!==t.scrollLeft&&null!==t.scrollTop)return{x:t.scrollLeft,y:t.scrollTop};if(null!==t.scrollX&&null!==t.scrollY)return{x:t.scrollX,y:t.scrollY};if(null!==t.pageXOffset&&null!==t.pageYOffset)return{x:t.pageXOffset,y:t.pageYOffset};throw"unable to scroll"},i=document.querySelector(".app-main"),s=document.querySelector(".app-timeLine"),n=document.querySelector(".app-timeLineMap"),r=document.querySelector(".page-app"),o=document.body,a={};a[0]=function(t,e){var a=60,h=180;e=Math.max(e,550);var c=40,l=Math.max(Math.min(.3*(e-c),320),h),u=e-l-a-c;u>400&&(u*=.95),u>600&&(u=600);var d=(e-u-l-c)/6;i.style.top=d+"px",i.style.height=u+"px",n.style.top=4*d+u+"px",n.style.height=c+"px",s.style.top=5*d+u+c+"px",s.style.height=l+"px",r.style.height=e+"px";var m=.8*t;500>m&&(m=.95*t),m>1400&&(m=1400),i.style.left=n.style.left=s.style.left=(t-m)/2+"px",i.style.width=n.style.width=s.style.width=m+"px",o.className="js-deferred-layout"};var h=function(){a[0](document.body.offsetWidth,window.innerHeight)},c=0,l=function(){window.clearTimeout(c),c=window.setTimeout(h,200)};h(),window.addEventListener("resize",l,!1);var u=document.querySelector(".page-app"),d=!1,m=function(){var i=e(document.body).y;Math.abs(i-u.offsetTop)<180&&(d=!0,t(document.body,0,u.offsetTop))},p=!1,f=!1,v=0,b=function(){return d?void(d=!1):(window.clearTimeout(v),void(p?f=!0:(f=!1,v=window.setTimeout(m,550))))},y=function(t){"mouseup"==t.type?(f&&(f=!1,window.clearTimeout(v),v=window.setTimeout(m,550)),p=!1):"mousedown"==t.type&&1==t.which&&t.currentTarget==document&&(p=!0)};window.addEventListener("scroll",b,!1),window.addEventListener("resize",b,!1),document.addEventListener("mousedown",y,!1),document.addEventListener("mouseup",y,!1)},{}],14:[function(t,e){var i=t("../../utils/Abstract"),s=(t("../../utils/point"),function(){return this.project=n.bind(this),this.unproject=r.bind(this),this.origin={x:0,y:0},this.zoom=2,this._zoom=a(this.zoom),this}),n=function(t){return{x:(t.x-this.origin.x)*this._zoom,y:(t.y-this.origin.y)*this._zoom}},r=function(t){return{x:t.x/this._zoom+this.origin.x,y:t.y/this._zoom+this.origin.y}},o=function(t,e,i){var s=5;if(t=Math.min(Math.max(0,+t),s),t==this.zoom)return!1;var n=this.unproject({x:+e,y:+i}),r=a(t);return this.origin.x=n.x-e/r,this.origin.y=n.y-i/r,this.zoom=t,this._zoom=r,!0},a=function(t){return 1<<t};e.exports=Object.create(i).extend({init:s,setZoom:o})},{"../../utils/Abstract":40,"../../utils/point":43}],15:[function(t,e){var i=t("../../utils/Abstract"),s=function(){return this.origin=0,this.zoom=30,this.window=30,this.cursor=0,this.project=n.bind(this),this.projectQ=r.bind(this),this.unproject=o.bind(this),this.quantify=a.bind(this),this},n=function(t){return(t-this.origin)/this.window},r=function(t){return this.quantify(this.project(t))},o=function(t){return t*this.window+this.origin},a=function(t){return Math.round(t)};e.exports=Object.create(i).extend({init:s})},{"../../utils/Abstract":40}],16:[function(t,e){var i=t("../../utils/Abstract"),s=function(){return this.options={view:{color:!0,stroke:!1},tool:{movePoint:!0,alterWidth:!1,alterSharpness:!1},camera:{translate:!0,zoom:!1}},this},n=function(){},r=function(){};e.exports=Object.create(i).extend({init:s,enableTool:n,disableTool:r})},{"../../utils/Abstract":40}],17:[function(t,e){var i=t("../../utils/Abstract"),s=t("../mixin/historizable"),n=t("./shape"),r=t("./line"),o=function(){return this.chunk={mustach_left:Object.create(r).init(),mustach_right:Object.create(r).init(),beard_left:Object.create(n).init(),beard_right:Object.create(n).init(),beard_mid:Object.create(n).init()},this},a=function(){var t={};for(var e in this.chunk)t[e]=this.chunck[e].pack();return t},h=function(t){for(var e in this.chunk)this.chunck[e].unpack(t[e]);return this};e.exports=Object.create(i).extend(s).extend({init:o,pack:a,unpack:h})},{"../../utils/Abstract":40,"../mixin/historizable":22,"./line":18,"./shape":19}],18:[function(t,e){var i=t("./shape"),s=t("../../system/pathJob"),n=t("../../utils/point"),r=t("../../model/mixin/historizable"),o=function(){return i.init.call(this),this.line=[],this.width=[],this},a=function(){return this.vertex=s.expandMustach(this.line,this.width),i.recompute.call(this)},h=function(){return{line:this.line.slice().map(n.copy),width:this.width.slice(),sharpness:r.deepCopy(this.sharpness)}};e.exports=Object.create(i).extend({init:o,recompute:a,pack:h})},{"../../model/mixin/historizable":22,"../../system/pathJob":39,"../../utils/point":43,"./shape":19}],19:[function(t,e){var i=t("../../utils/Abstract"),s=t("../mixin/historizable"),n=t("../../system/pathJob"),r=t("../../utils/point"),o=function(){return this.vertex=[],this.sharpness=[],this.bezierPath=[],this},a=function(){return this.bezierPath=n.bezify(this.vertex,this.sharpness),this},h=function(){return{vertex:this.vertex.slice().map(r.copy),sharpness:s.deepCopy(this.sharpness)}};e.exports=Object.create(i).extend(s).extend({init:o,recompute:a,pack:h})},{"../../system/pathJob":39,"../../utils/Abstract":40,"../../utils/point":43,"../mixin/historizable":22}],20:[function(t,e){var i=t("../../utils/Abstract"),s=t("../mixin/historizable"),n=function(){return this.keys={},this},r=function(t,e){return t.date<e.date?-1:1},o=function(t,e,i){this.keys[t]||(this.keys[t]=[]);for(var s=this.keys[t].length;s--;)if(this.keys[t][s].date==e)return void(this.keys[t][s].pack=i);var n;return this.keys[t].push(n={date:e,pack:i}),this.keys[t].sort(r),n},a=function(t,e){var i;if(this.keys[t]&&!((i=this.keys[t].indexOf(e))<=-1))return this.keys[t].splice(i,1)[0]},h=function(t,e,i){return e.date=i,this.keys[t].sort(r),e};e.exports=Object.create(i).extend(s).extend({init:n,addOrSetKey:o,setKeyDate:h,removeKey:a})},{"../../utils/Abstract":40,"../mixin/historizable":22}],21:[function(t,e){var i=t("../utils/Abstract"),s=t("./mixin/historizable"),n=t("../system/eventDispatcher"),r=function(){return this.stack=[],this.undo_stack=[],this},o=function(t){for(this.stack.push({model:t,pack:t.pack()}),this.undo_stack.length=0;this.stack.length>50;)this.stack.shift()},a=function(){n.dispatch("change:timeLine",{no_history:!0})},h=function(t){if(this.stack.length<=1)return!1;var t=this.stack.pop(),e=this.stack[this.stack.length-1];t.model.unpack(s.deepCopy(e.pack)),a(t.model),this.undo_stack.push(t)},c=function(t){if(!this.undo_stack.length)return!1;var t=this.undo_stack.pop();t.model.unpack(s.deepCopy(t.pack)),this.stack.push(t),a(t.model)};e.exports=Object.create(i).extend(s).extend({init:r,undo:h,redo:c,save:o})},{"../system/eventDispatcher":36,"../utils/Abstract":40,"./mixin/historizable":22}],22:[function(t,e){var i=function(t){if("object"!=typeof t)return t;if(Array.isArray(t))return t.map(i);var e={};for(var s in t)"function"!=typeof t[s]&&(e[s]=i(t[s]));return e},s=function(t){for(var e in t)this[e]=i(t[e]);return this};e.exports={pack:function(){return i(this)},unpack:s,deepCopy:i}},{}],23:[function(t,e){var i=t("../utils/Abstract"),s=t("../system/eventDispatcher"),n=function(t){s.dispatch("ui-"+t.type,{mouseEvent:t})},r=function(){return document.addEventListener("mousedown",n,!1),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",n,!1),document.addEventListener("keydown",n,!1),this};e.exports=Object.create(i).extend({init:r})},{"../system/eventDispatcher":36,"../utils/Abstract":40}],24:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/domHelper"),n=t("./svg-util"),r=function(){var t=this.model.face,e=this.model.camera,i=function(t){var i=e.project(t);return i.type=t.type,i};for(var s in t.chunk)t.chunk[s].recompute(),this.dom[s].setAttribute("d",n.renderBezier(t.chunk[s].bezierPath.map(i)));o.call(this)},o=function(){var t=this.model.face,e=this.model.toolkit.options.view.stroke,i=this.model.toolkit.options.view.color;for(var n in t.chunk)s[e?"addClass":"removeClass"](this.dom[n],"stroke"),s[i?"addClass":"removeClass"](this.dom[n],"color")},a=function(t){var e=this.model.face;this.dom={};var i=1;for(var s in e.chunk)this.dom[s]=n.create("path"),this.dom[s].setAttribute("class","hair-chunk "+s+" hair-chunk-"+i++),t.appendChild(this.dom[s])},h=function(t,e,i){return this.model={face:t.face,camera:t.camera,toolkit:t.toolkit},a.call(this,i),this.ed=e,e.listen("render",r.bind(this),this),this};e.exports=Object.create(i).extend({init:h,render:r})},{"../../utils/Abstract":40,"../../utils/domHelper":41,"./svg-util":27}],25:[function(t,e){var i=t("../../utils/Abstract"),s=t("./svg-util"),n=function(t,e){var i=s.create("circle");return i.setAttribute("cx",t),i.setAttribute("cy",e),i.setAttribute("r",5),i.setAttribute("class","control-tic"),i},r=function(){var t=this.model.face,e=this.model.camera.project,i=this.model.toolkit.options.tool.movePoint;for(var s in t.chunk){var r=this.dom[s],o=t.chunk[s];r.innerHTML="";var a,h,c;o.line?(a=o.line,h="control-line",c="line"):(a=o.vertex,h="control-path",c="vertex"),i&&a.map(e).forEach(function(t,e){var i=n(t.x,t.y);i.setAttribute("class","control-tic "+h),i.setAttribute("data-i",e),i.setAttribute("data-chunk",s),i.setAttribute("data-pool",c),r.appendChild(i)})}},o=function(t){var e=this.model.face;this.dom={};var i=1;for(var n in e.chunk)this.dom[n]=s.create("g"),this.dom[n].setAttribute("class","control control-"+n+" control-"+i++),this.dom[n].setAttribute("data-chunk",n),t.appendChild(this.dom[n])},a=function(t,e,i){return this.model={face:t.face,camera:t.camera,toolkit:t.toolkit},this.ed=e,o.call(this,i),this.ed.listen("render",r.bind(this),this),this};e.exports=Object.create(i).extend({init:a,render:r})},{"../../utils/Abstract":40,"./svg-util":27}],26:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/point"),n=(t("../../system/pathJob"),t("./svg-util")),r=function(t,e,i){var s=60/180*Math.PI,r=Math.min(.5*i,10),o=e.x*i,a=e.y*i,h=e.x*r,c=e.y*r,l=Math.cos(s),u=Math.sin(s),d=n.create("path"),m="M"+t.x+" "+t.y+"L"+(t.x+a*u+o*l)+" "+(t.y-o*u+a*l)+"A"+i+" "+i+", 0, 0, 1,"+(t.x+o)+" "+(t.y+a)+"A"+i+" "+i+", 0, 0, 1,"+(t.x-a*u+o*l)+" "+(t.y+o*u+a*l)+"z",m="M"+(t.x+a*u+o*l)+" "+(t.y-o*u+a*l)+"A"+i+" "+i+", 0, 0, 1,"+(t.x+o)+" "+(t.y+a)+"A"+i+" "+i+", 0, 0, 1,"+(t.x-a*u+o*l)+" "+(t.y+o*u+a*l)+"L"+(t.x-c*u+h*l)+" "+(t.y+h*u+c*l)+"A"+r+" "+r+", 0, 0, 0,"+(t.x+h)+" "+(t.y+c)+"A"+r+" "+r+", 0, 0, 0,"+(t.x+c*u+h*l)+" "+(t.y-h*u+c*l)+"z";return d.setAttribute("d",m),d},o=function(){for(var t in this.dom)this.dom[t].innerHTML=""},a=function(){var t=!this.model.toolkit.options.tool.alterSharpness;if(t)return void(this._isEmpty||(o.call(this),this._isEmpty=!0));this._isEmpty=!1;var e=this.model.face,i=(this.model.camera._zoom,this.model.camera.project);o.call(this);for(var n in e.chunk){var a,h=this.dom[n],c=e.chunk[n];(a=c.vertex.map(i)).forEach(function(t,e){var i=(e+1)%c.vertex.length,o=(e-1+c.vertex.length)%c.vertex.length,l=s.normalize(s.diff(a[o],t)),u=s.normalize(s.diff(a[i],t)),d=15+60*c.sharpness[e].before,m=15+60*c.sharpness[e].after,p=r(t,l,d);p.setAttribute("class","control-sharpness-tic"),p.setAttribute("data-i",e),p.setAttribute("data-chunk",n),p.setAttribute("data-sens","before"),h.appendChild(p);var p=r(t,u,m);p.setAttribute("class","control-sharpness-tic"),p.setAttribute("data-i",e),p.setAttribute("data-chunk",n),p.setAttribute("data-sens","after"),h.appendChild(p)})}},h=function(t){var e=this.model.face;this.dom={};var i=1;for(var s in e.chunk)this.dom[s]=n.create("g"),this.dom[s].setAttribute("class","control-sharpness control-sharpness-"+s+" control-sharpness-"+i++),this.dom[s].setAttribute("data-chunk",s),t.appendChild(this.dom[s])},c=function(t,e,i){return this.model={face:t.face,camera:t.camera,toolkit:t.toolkit},this.ed=e,h.call(this,i),this.ed.listen("render",a.bind(this),this),this};e.exports=Object.create(i).extend({init:c,render:a})},{"../../system/pathJob":39,"../../utils/Abstract":40,"../../utils/point":43,"./svg-util":27}],27:[function(t,e){var i=function(t){return(0|100*t)/100},s=function(t){return i(t.x)+" "+i(t.y)},n=function(t){if(!t.length)return"";for(var e="M"+s(t[0]),i=1;i<t.length;i++)switch(t[i].type){case"F":e+="L"+s(t[i]);break;case"C":e+="Q"+s(t[i++])+" "+s(t[i])}return e+"z"},r=function(t,e){return"M"+t.reduce(function(t,e){return t+"L"+s(e)},"").slice(1)+(e?"z":"")},o="http://www.w3.org/2000/svg",a=function(t){return document.createElementNS(o,t)};e.exports={renderBezier:n,renderLine:r,create:a,svgNS:o}},{}],28:[function(t,e){var i=t("../../utils/Abstract"),s=(t("../../utils/point"),t("../../system/pathJob")),n=t("./svg-util"),r=function(t,e){var i=n.create("circle");return i.setAttribute("cx",t),i.setAttribute("cy",e),i.setAttribute("r",5),i},o=function(t,e,i,s){var r=n.create("line");return r.setAttribute("x1",t),r.setAttribute("y1",e),r.setAttribute("x2",i),r.setAttribute("y2",s),r.setAttribute("class","control-line"),r},a=function(){for(var t in this.dom)this.dom[t].innerHTML=""},h=function(){var t=!this.model.toolkit.options.tool.alterWidth;if(t)return void(this._isEmpty||(a.call(this),this._isEmpty=!0));this._isEmpty=!1;var e=this.model.face,i=this.model.camera.project;a.call(this);for(var n in e.chunk){var h=this.dom[n],c=e.chunk[n];if(c.line){var l=s.expandMustach(c.line,c.width).map(i);c.line.map(i).forEach(function(t,e){if(0!=e&&e!=c.line.length-1){var i=c.line.length-2+e,s=c.line.length-2-e,a=o(l[i].x,l[i].y,l[s].x,l[s].y);h.appendChild(a);var u=r(l[i].x,l[i].y);u.setAttribute("class","control-width-tic"),u.setAttribute("data-i",e),u.setAttribute("data-chunk",n),h.appendChild(u);var d=r(l[s].x,l[s].y);d.setAttribute("class","control-width-tic"),d.setAttribute("data-i",e),d.setAttribute("data-chunk",n),h.appendChild(d)}})}}},c=function(t){var e=this.model.face;this.dom={};var i=1;for(var s in e.chunk)e.chunk[s].line&&(this.dom[s]=n.create("g"),this.dom[s].setAttribute("class","control-width control-width-"+s+" control-width-"+i++),this.dom[s].setAttribute("data-chunk",s),t.appendChild(this.dom[s]))},l=function(t,e,i){return this.model={face:t.face,camera:t.camera,toolkit:t.toolkit},this.ed=e,c.call(this,i),this.ed.listen("render",h.bind(this),this),this};e.exports=Object.create(i).extend({init:l,render:h})},{"../../system/pathJob":39,"../../utils/Abstract":40,"../../utils/point":43,"./svg-util":27}],29:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/domHelper"),n=function(t){if(1===t.which){var e=t.target.getAttribute("class").split(" "),i=s.offset(t.target),n=t.pageX-i.left,r=t.pageY-i.top,o=this.model.camera.unproject({x:n,y:r}),a=!0;e.indexOf("control-tic")>=0&&"wheel"!=t.type?(this.ed.dispatch("ui-tic-"+t.type,{mouseEvent:t,pool:t.target.getAttribute("data-pool"),chunk:t.target.getAttribute("data-chunk"),i:t.target.getAttribute("data-i"),x:o.x,y:o.y,screenY:r,screenX:n,primaryTarget:!0}),a=!1):e.indexOf("control-width-tic")>=0&&"wheel"!=t.type?(this.ed.dispatch("ui-width-tic-"+t.type,{mouseEvent:t,chunk:t.target.getAttribute("data-chunk"),i:t.target.getAttribute("data-i"),x:o.x,y:o.y,screenY:r,screenX:n,primaryTarget:!0}),a=!1):e.indexOf("control-sharpness-tic")>=0&&"wheel"!=t.type&&(this.ed.dispatch("ui-sharpness-tic-"+t.type,{mouseEvent:t,chunk:t.target.getAttribute("data-chunk"),i:t.target.getAttribute("data-i"),sens:t.target.getAttribute("data-sens"),x:o.x,y:o.y,screenY:r,screenX:n,primaryTarget:!0}),a=!1),this.ed.dispatch("ui-zone-"+t.type,{mouseEvent:t,x:o.x,y:o.y,screenY:r,screenX:n,primaryTarget:a}),"wheel"==t.type&&this.ed.hasListener("ui-zone-wheel")&&(t.stopPropagation(),t.preventDefault())}},r=function(t,e,i){this.model={camera:t.camera};var s=n.bind(this);return i.addEventListener("mousedown",s,!1),i.addEventListener("mousemove",s,!1),i.addEventListener("mouseup",s,!1),i.addEventListener("wheel",s,!1),this.ed=e,this.domSvg=i,this};e.exports=Object.create(i).extend({init:r})},{"../../utils/Abstract":40,"../../utils/domHelper":41}],30:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/domHelper"),n=(t("../../system/eventDispatcher"),t("../../system/histogram")),r=t("../svg/svg-util"),o=function(){var t=this.model.timeLine,e=this.model.timeLineState,i=e.cursor,s=e.cursor;for(var n in t.keys)t.keys[n].length&&(i=Math.max(i,t.keys[n][t.keys[n].length-1].date),s=Math.min(s,t.keys[n][0].date));s=Math.min(s,e.origin),i=Math.max(i,e.origin+e.window),i+=5,s-=5;
var r=this.end!==i||this.start!==s;return this.end=i,this.start=s,r},a=function(){var t=n.discretise(this.model.timeLine.keys,2);this.domHist.innerHTML="";for(var e=this.start+(t.offset-this.start)%t.w,i=e;i<this.end;i+=t.w){var s=(i-t.offset)/t.w,r=0>s||s>=t.q.length?0:t.q[s];if(r){var o=(i+t.w/2-.5-this.start)/(this.end-this.start),a=4*r,h=document.createElement("div");h.setAttribute("class","tlm-histogram-point"),h.style.width=h.style.height=a+"px",h.style.left="calc("+100*o+"% - "+a/2+"px )",h.style.top="calc( 50% - "+a/2+"px)",this.domHist.appendChild(h)}}},h=function(){this.domFrame.style.width=this.model.timeLineState.window/(this.end-this.start)*100+"%",this.domFrame.style.left=(this.model.timeLineState.origin-this.start)/(this.end-this.start)*100+"%"},c=function(){this.domCursor.style.left=(this.model.timeLineState.cursor-this.start)/(this.end-this.start)*100+"%"},l=function(){o.call(this),h.call(this),c.call(this),a.call(this)},u=['<div class="tlm-frame">',"</div>"].join(""),d=['<div class="tlm-cursor">',"</div>"].join(""),m=function(t){s.addClass(t,"tlm"),this.domFrame=s.domify(u),this.domCursor=s.domify(d),this.domSvg=r.create("svg"),this.domHist=document.createElement("div"),this.domHist.setAttribute("class","tlm-histogram"),t.appendChild(this.domHist),t.appendChild(this.domFrame),t.appendChild(this.domCursor)},p=function(t,e,i){return this.model={timeLineState:t.timeLineState,timeLine:t.timeLine},m.call(this,i),e.listen("change:timeLineState-cursor",l.bind(this),this),e.listen("change:timeLineState-viewport",l.bind(this),this),e.listen("change:timeLine",l.bind(this),this),this};e.exports=Object.create(i).extend({init:p})},{"../../system/eventDispatcher":36,"../../system/histogram":37,"../../utils/Abstract":40,"../../utils/domHelper":41,"../svg/svg-util":27}],31:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/domHelper"),n=t("../../system/eventDispatcher"),r=([].join(""),['<div class="tl-key">',"</div>"].join("")),o=['<div class="tl-row">','<svg class="tl-icon" viewBox="0 0 100 100"><path d="M50 0L93.3 25L93.3 75L50 100L6.7 75L6.7 25z"></path></svg>','<span class="tl-label"></span>','<div class="tl-toolBar"></div>',"</div>"].join(""),a=['<div class="tl-row">',"</div>"].join(""),h=['<div class="tl">','<div class="tl-left">','<div class="tl-global-label"></div>','<div class="tl-block-label"></div>',"</div>",'<div class="tl-right">','<div class="tl-right-push"></div>','<div class="tl-block-lines"></div>','<div class="tl-cursor"></div>',"</div>","</div>"].join(""),c=function(t){if(1===t.which){var e,i,r=s.offset(this.domBlockLines),o=t.pageX-r.left,a=t.pageY-r.top,h=o/this.domBlockLines.offsetWidth,c=this.model.timeLineState.unproject(h),l=!0;s.getParent(t.target,"tl-cursor")&&(n.dispatch("ui-tlCursor-"+t.type,{date:c,y:a,x:o,xPer:h,mouseEvent:t,primaryTarget:l}),l=!1),(e=s.getParent(t.target,"tl-key"))&&(n.dispatch("ui-tlKey-"+t.type,{mouseEvent:t,chunk:s.getParent(e,"tl-row").getAttribute("data-chunk"),i:e.getAttribute("data-i"),date:c,y:a,x:o,xPer:h,primaryTarget:l}),l=!1),(i=s.getParent(t.target,"tl-row"))&&n.dispatch("ui-tlLine-"+t.type,{mouseEvent:t,chunk:i.getAttribute("data-chunk"),date:c,y:a,x:o,xPer:h,primaryTarget:l}),n.dispatch("ui-tl-"+t.type,{mouseEvent:t,date:c,y:a,x:o,xPer:h,primaryTarget:l}),t.preventDefault()}},l=function(){var t=this.model.timeLine,e=this.model.timeLineState.project;for(var i in this.domLines){for(var n=this.domLines[i].children,o=n.length;o--;)n[o].remove();for(var o=(t.keys[i]||[]).length;o--;){var a=e(t.keys[i][o].date);if(!(-.01>a||a>1.01)){var h=s.domify(r);h.setAttribute("data-i",o),h.style.left="calc( "+100*a+"% - 5px )",this.domLines[i].appendChild(h)}}}},u=function(){var t=this.model.timeLineState.project(this.model.timeLineState.cursor);this.domCursor.style.left="calc( "+100*t+"% - 0.5px )",this.domCursor.style.display=t>0&&1>t?"":"none"},d=function(){var t=this.model.face;this.domEl=s.domify(h);var e=this.domEl.querySelector(".tl-block-label"),i=this.domEl.querySelector(".tl-block-lines");this.domCursor=this.domEl.querySelector(".tl-cursor"),this.domLines={};for(var n in t.chunk){var r=s.domify(o),c=s.domify(a);r.querySelector(".tl-label").innerHTML=n.replace("_"," "),c.setAttribute("data-chunk",n),e.appendChild(r),i.appendChild(c),this.domLines[n]=c}this.domBlockLines=i},m=function(t,e,i){this.model={face:t.face,timeLineState:t.timeLineState,timeLine:t.timeLine},d.call(this),i.className+=" tl";for(var s=this.domEl.children.length;s--;)i.appendChild(this.domEl.children[s]);return this.domEl=i,e.listen("change:timeLine",l.bind(this),this),e.listen("change:timeLineState-cursor",u.bind(this),this),e.listen("change:timeLineState-viewport",u.bind(this),this),e.listen("change:timeLineState-viewport",l.bind(this),this),this.domEl.querySelector(".tl-right").addEventListener("mousedown",c.bind(this),!1),this.domEl.querySelector(".tl-right").addEventListener("mouseup",c.bind(this),!1),this.domEl.querySelector(".tl-right").addEventListener("mousemove",c.bind(this),!1),this.domEl.querySelector(".tl-right").addEventListener("wheel",c.bind(this),!1),this.domEl.querySelector(".tl-right").addEventListener("shortclick",c.bind(this),!1),this};e.exports=Object.create(i).extend({init:m})},{"../../system/eventDispatcher":36,"../../utils/Abstract":40,"../../utils/domHelper":41}],32:[function(t,e){var i=t("../../utils/Abstract"),s=t("../../utils/domHelper"),n=['<li class="tb-category">','<span class="tb-category-label"></span>',"<ul></ul>","</li>"].join(""),r=['<li class="tb-switch">','<svg class="tb-switch-back" viewBox="0 0 240 120">','<use class="tb-swicth-icon-on" y="10" x="10" xlink:href = "#svg_hexagon"></use>','<use class="tb-swicth-icon-off" y="10" x="130" xlink:href = "#svg_hexagon"></use>',"</svg>",'<div class="tb-switch-front-viewport">','<svg class="tb-switch-front" viewBox="0 0 240 120">','<use class="tb-swicth-icon-on" y="10" x="10" xlink:href = "#svg_hexagon"></use>','<use class="tb-swicth-icon-off" y="10" x="130" xlink:href = "#svg_hexagon"></use>',"</svg>","</div>","</li>"].join(""),o=function(t){var e=this.model.toolkit.options,i=document.createElement("ul");t.appendChild(i),this.dom={};for(var o in e){var h=s.domify(n);h.querySelector(".tb-category-label").className+=" tb-category-"+o,h.querySelector(".tb-category-label").innerHTML+=o;var u=h.querySelector("ul");i.appendChild(h);for(var d in e[o])this.dom[d]=s.domify(r),this.dom[d].className+=" tb-switch-"+d,this.dom[d].setAttribute("data-category",o),this.dom[d].setAttribute("data-option",d),u.appendChild(this.dom[d]),this.dom[d].addEventListener("mouseenter",c.bind(this),!1),this.dom[d].addEventListener("mouseleave",l.bind(this),!1)}a.call(this),this.domTooltip=document.createElement("div"),this.domTooltip.className="tb-tooltip",document.body.appendChild(this.domTooltip)},a=function(){var t=this.model.toolkit.options;for(var e in t)for(var i in t[e])s[t[e][i]?"addClass":"removeClass"](this.dom[i],"enabled")},h=function(t,e,i){return this.model={toolkit:t.toolkit},this.ed=e,o.call(this,i),this.ed.listen("change:toolkit",a.bind(this),this),i.addEventListener("click",u.bind(this),!1),this},c=function(t){if(s.hasClass(t.target,"tb-switch")){var e=t.target.getBoundingClientRect();this.domTooltip.style.display="",this.domTooltip.style.top=e.top+window.scrollY+"px",this.domTooltip.style.left=e.right+window.scrollX+15+"px",this.domTooltip.innerHTML=t.target.getAttribute("data-option")}},l=function(){this.domTooltip.style.display="none"},u=function(t){var e;(e=s.getParent(t.target,"tb-switch"))&&this.ed.dispatch("ui-toolbar-"+t.type,{category:e.getAttribute("data-category"),option:e.getAttribute("data-option"),mouseEvent:t})};e.exports=Object.create(i).extend({init:h})},{"../../utils/Abstract":40,"../../utils/domHelper":41}],33:[function(t,e){var i=t("../utils/Abstract"),s=t("../system/eventDispatcher"),n=t("../system/interpolate"),r=function(t){return this.model={face:t.face,timeLine:t.timeLine,timeLineState:t.timeLineState},this.changeShape=h.bind(this),this.changeCursor=c.bind(this),this},o=function(){this.disable(),s.listen("change:shape",this.changeShape,this),s.listen("change:timeLineState-cursor",this.changeCursor,this)},a=function(){s.unlisten("change:shape",this),s.unlisten("change:timeLineState-cursor",this)},h=function(t){if(!t.wip&&!t.is_interpolation){for(var e in this.model.face.chunk)if(this.model.face.chunk[e]==t.shape)break;this.model.timeLine.addOrSetKey(e,this.model.timeLineState.cursor,t.shape.pack()),s.dispatch("change:timeLine",{wip:!1})}},c=function(t){var e=this.model.face.chunk,i=this.model.timeLineState.cursor,r=this.model.timeLine.keys;if(this._cursor!=i)for(var o in r){var a=r[o];if(i<=a[0].date)e[o].unpack(a[0].pack);else if(i>=a[a.length-1].date)e[o].unpack(a[a.length-1].pack);else{for(var h=1;h<a.length&&a[h].date<i;h++);var c=a[h-1],l=a[h],u=(i-c.date)/(l.date-c.date);e[o].unpack(n.lerpPack(c.pack,l.pack,u))}s.dispatch("change:point",{wip:t.wip,shape:e[o],is_interpolation:!0})}};e.exports=Object.create(i).extend({init:r,enable:o,disable:a})},{"../system/eventDispatcher":36,"../system/interpolate":38,"../utils/Abstract":40}],34:[function(t,e){var i=t("../utils/Abstract"),s=function(t,e,i){this.model={toolkit:t.toolkit},this.ctrls=i,this.changeToolkit=a.bind(this),this.ed=e,this._previous={};for(var s in o)this._previous[o[s]]=!0;return this},n=function(){this.disable(),this.ed.listen("change:toolkit",this.changeToolkit)},r=function(){this.ed.unlisten("change:toolkit",this.changeToolkit)},o={"camera-zoom":"drawZoneZoom","camera-translate":"drawZoneTranslate","tool-movePoint":"dragPoint"},a=function(){var t=this.model.toolkit.options;for(var e in t)for(var i in t[e]){var s=o[e+"-"+i],n=t[e][i];s&&this._previous[s]!=n&&(this.ctrls[s][n?"enable":"disable"](),this._previous[s]=n)}};e.exports=Object.create(i).extend({init:s,enable:n,disable:r})},{"../utils/Abstract":40}],35:[function(t,e){var i=t("../utils/Abstract"),s=t("../system/eventDispatcher"),n=function(){return this.changePoint=a.bind(this),this},r=function(){this.disable(),s.listen("change:point",this.changePoint,this)},o=function(){s.unlisten("change:point",this)},a=function(t){t.shape.recompute(),s.dispatch("change:shape",{wip:t.wip,is_interpolation:t.is_interpolation,shape:t.shape})};e.exports=Object.create(i).extend({init:n,enable:r,disable:o})},{"../system/eventDispatcher":36,"../utils/Abstract":40}],36:[function(t,e){var i=t("../utils/Abstract"),s=function(t,e){this._lock=!0;for(var i=(this.listener||{})[t]||[],s=0;s<i.length;s++)i[s].fn(e,t);for(this._lock=!1;(this._stack||[]).length;){var n=this._stack.shift();this[n.fn].apply(this,n.args)}return this},n=function(t,e,i){return this._lock?void(this._stack=this._stack||[]).push({fn:"listen",args:arguments}):(this.listener=this.listener||{},(this.listener[t]=this.listener[t]||[]).push({fn:e,key:i}),this)},r=function(t,e){if(this._lock)return void(this._stack=this._stack||[]).push({fn:"unlisten",args:arguments});for(var i=(this.listener||{})[t]||[],s=i.length;s--;)(i[s].key==e||i[s].fn==e)&&i.splice(s,1);return this},o=function(t){return!!((this.listener||{})[t]||[]).length},a=function(){this.listener={}};e.exports=Object.create(i).extend({dispatch:s,listen:n,unlisten:r,hasListener:o,reset:a})},{"../utils/Abstract":40}],37:[function(t,e){var i=function(t,e,i){e=e||1,i=i||0;var s=[];for(var n in t)for(var r=t[n].length;r--;){var o=0|(t[n][r].date-i)/e;s[o]=(0|s[o])+1}return{offset:i,w:e,q:s}};e.exports={discretise:i}},{}],38:[function(t,e){var i=t("../utils/point"),s=function(t,e,s){for(;t.length<e.length;)t.push(i.copy(e[e.length-1]));for(;e.length<t.length;)e.push(i.copy(t[t.length-1]));for(var n=[],r=0;r<t.length;r++)n.push(s(t[r],e[r]));return n},n=function(t,e,n){var r={},o=1-n;for(var a in t)switch(a){case"line":case"vertex":r[a]=s(t[a],e[a],function(t,e){return i.lerp(t,e,n)});break;case"width":r[a]=s(t[a],e[a],function(t,e){return t*o+e*n});break;case"sharpness":r[a]=s(t[a],e[a],function(t,e){return{before:t.before*o+e.before*n,after:t.after*o+e.after*n}})}return r};e.exports={lerpPack:n}},{"../utils/point":43}],39:[function(t,e){var i=t("../utils/point"),s=function(t){for(var e,i,s=t[0],n=t.length;n--;)e=s,s=t[n],(i=s.after+e.before>1)&&(s.after/=i,e.before/=i);return t},n=function(t,e){var n;if(t.length<2)return[];e&&"number"!=typeof e?s(e):n=e||.25;for(var r,o,a,h,c,l,u=t[0],d=t[1],m=[],p=t.length;p--;)r=d,d=u,u=t[p],l=(p+1)%t.length,c=n||e[l].before,h=n||e[l].after,o=i.lerp(d,u,c),a=i.lerp(d,r,h),o.type="F",a.type="F",d.type="C",m.push(a,d,o);return m},r=function(t,e){return t.reduce(function(s,n,r){if(0==r||r==t.length-1)return s.push(n),s;var o=i.normalize(i.diff(t[r-1],n)),a=i.normalize(i.diff(n,t[r+1])),h=o;h.x=a.x+o.x,h.y=a.y+o.y,i.normalize(h);var c=h.x;return h.x=h.y,h.y=-c,s.unshift({x:n.x+h.x*e[r],y:n.y+h.y*e[r]}),s.push({x:n.x-h.x*e[r],y:n.y-h.y*e[r]}),s},[])};e.exports={expandMustach:r,bezify:n}},{"../utils/point":43}],40:[function(t,e){e.exports={init:function(){return this},extend:function(t){for(var e in t)this[e]=t[e];return this}}},{}],41:[function(t,e){e.exports={hasClass:function(t,e){return t.classList.contains(e)},addClass:function(t,e){this.hasClass(t,e)||t.setAttribute("class",t.getAttribute("class")+" "+e)},removeClass:function(t,e){if(this.hasClass(t,e)){for(var i="",s=t.getAttribute("class").trim().split(" "),n=s.length;n--;)e!=s[n]&&(i+=" "+s[n]);t.setAttribute("class",i)}},getParent:function(t,e){for(;;){if(!t||this.hasClass(t,e))break;t=t.parentElement}return t},offset:function(t){for(var e={left:0,top:0};t&&null!==t.offsetLeft;)e.left+=t.offsetLeft,e.top+=t.offsetTop,t=t.parentElement;return e},bind:function(t,e,i){var s=e.split(" ");if(s.length>1)for(var n=s.length;n--;)this.bind(t,s[n],i);else t._bindHandlers=t._bindHandlers||{},this.unbind(t,e),t.addEventListener(e.split(".")[0],i,!1),t._bindHandlers[e]=i},unbind:function(t,e){var i=e.split(" ");if(i.length>1)for(var s=i.length;s--;)this.unbind(t,i[s]);else t._bindHandlers&&t._bindHandlers[e]&&(t.removeEventListener(e.split(".")[0],t._bindHandlers[e],!1),t._bindHandlers[e]=null)},domify:function(){if("object"!=typeof document)return function(){};var t=document.createElement("div");return function(e){t.innerHTML=e;var i=t.children[0];return t.innerHTML="",i}}()}},{}],42:[function(){!function(){var t,e,i={},s=0;document.addEventListener("mousedown",function(n){0==s||n.timeStamp-t>400?(t=n.timeStamp,e=n.target,i.x=n.pageX,i.y=n.pageY,s=1):s++}),document.addEventListener("mouseup",function(n){if(e!=n.target||n.timeStamp-t>400||Math.abs(i.x-n.pageX)>25||Math.abs(i.y-n.pageY)>25)return void(s=0);if(s>=2){var r=new MouseEvent("doubleclick",n);n.target.dispatchEvent(r),s=0}})}()},{}],43:[function(t,e){var i={};i.scalaire=function(t,e){return t.x*e.x+t.y*e.y},i.norme=function(t){return Math.sqrt(i.scalaire(t,t))},i.distanceSqrt=function(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},i.distance=function(t,e){return Math.sqrt(this.distanceSqrt(t,e))},i.normalize=function(t){var e=i.norme(t);return t.x/=e,t.y/=e,t},i.diff=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},i.lerp=function(t,e,i){var s=1-i;return{x:t.x*s+e.x*i,y:t.y*s+e.y*i}},i.copy=function(t){return{x:t.x,y:t.y}},e.exports=i},{}],44:[function(){!function(){var t,e,i={};document.addEventListener("mousedown",function(s){t=s.timeStamp,e=s.target,i.x=s.pageX,i.y=s.pageY}),document.addEventListener("mouseup",function(s){if(!(e!=s.target||s.timeStamp-t>200||Math.abs(i.x-s.pageX)>25||Math.abs(i.y-s.pageY)>25)){var n=new MouseEvent("shortclick",s);s.target.dispatchEvent(n)}})}()},{}]},{},[1]);